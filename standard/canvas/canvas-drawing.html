<!DOCTYPE html>
<!--
Sample: Canvas drawing.
[AJ]
-->
<html>
    <body>
        <canvas id="canvas" width="800" height="600" style="border:1px solid #000000;">
        </canvas>
    </body>
</html>

<script type="text/javascript">

// Geometry

var Drawer = {
    drawSquare: function (context, x, y, w) {
        context.moveTo(x, y);
        context.lineTo(x, y + w);
        context.lineTo(x + w, y + w);
        context.lineTo(x + w, y);
        context.lineTo(x, y);

        context.stroke();
    },

    drawRectangle: function (context, x, y, w, h) {
        context.moveTo(x, y);
        context.lineTo(x, y + h);
        context.lineTo(x + w, y + h);
        context.lineTo(x + w, y);
        context.lineTo(x, y);

        context.stroke();
    },

    drawText: function (context, str, x, y) {
        context.fillText(str, x, y);
    },

    drawLine: function (context, x1, y1, x2, y2) {
        context.beginPath();

        context.moveTo(x1, y1);
        context.moveTo(x2, y2);

        context.stroke();
    }
};

// Mouse coordinates

var Canvas = {
    elementId: null,
    canvas: null,
    context: null,
    mouse: {
        isDown: false,
        isDragging: false
    },

    items: [],

    getContext: function () {
        return this.context;
    },

    getPosition: function (event) {
        var x = event.x;
        var y = event.y;

        x -= canvas.offsetLeft;
        y -= canvas.offsetTop;

        return {x: x, y: y};
    },

    setElementId: function (id) {
        this.elementId = id;
    },

    init: function () {
        this.canvas = document.getElementById("canvas");

        this.context = canvas.getContext("2d");

        this.initListeners();
    },

    initListeners: function () {
        // Mouse events

        var self = this;

        // Mousedown

        canvas.addEventListener("mousedown", function (e) { self.callbackMouseDown(e) }, false);

        // Mouseup

        canvas.addEventListener("mouseup", function (e) { self.callbackMouseUp(e) }, false);

        document.addEventListener("mouseup", function (e) { self.callbackDocMouseUp(e) }, false);

        // Mousemove

        canvas.addEventListener('mousemove', function (e) { self.callbackMouseMove(e) }, false);

        // Mouseenter

        canvas.addEventListener('mouseenter', function (e) { self.callbackMouseEnter(e) }, false);

        // Mouseout

        canvas.addEventListener('mouseout', function (e) { self.callbackMouseOut(e) }, false);
    },

    callbackMouseDown: function (event) {
        var position = Canvas.getPosition(event);

        console.log("mousedown x:" + position.x + ", y:" + position.y);

        Canvas.mouse.isDown = true;

        for (var itemIndex = 0; itemIndex < this.items.length; itemIndex++) {
            console.log('Draw section ' + itemIndex + ': ', this.items[itemIndex]);

            var item = this.items[itemIndex];

            if (this.mouseIsWithinSection(event, item)) {
                console.log('MOUSE DOWN INSIDE SECTION');
            }
            else {
                console.log('MOUSE DOWN OUTSIDE SECTION');
            }
        }
    },

    callbackMouseUp: function (event) {
        var position = Canvas.getPosition(event);

        console.log("mouseup x:" + position.x + ", y:" + position.y);

        Canvas.mouse.isDown = false;

        if (!Canvas.mouse.isDragging) {
            console.log('dragging stopped');

            Canvas.mouse.isDragging = false;
        }
    },

    callbackDocMouseUp: function (event) {
        console.log('callbackDocMouseUp()');

        Canvas.mouse.isDown = false;

        if (!Canvas.mouse.isDragging) {
            console.log('dragging stopped');

            Canvas.mouse.isDragging = false;
        }
    },

    callbackMouseMove: function(event) {
        var mousePos = Canvas.getPosition(event);

        console.log('mousemove: ' + mousePos.x + ',' + mousePos.y);

        if (Canvas.mouse.isDown) {
            if (!Canvas.mouse.isDragging) {
                console.log('dragging started');

                Canvas.mouse.isDragging = true;
            }

            console.log('dragging');
        }
    },

    callbackMouseEnter: function(event) {
        var mousePos = Canvas.getPosition(event);

        console.log('mouseenter: ' + mousePos.x + ',' + mousePos.y);
    },

    callbackMouseOut: function(event) {
        var mousePos = Canvas.getPosition(event);

        console.log('mouseout: ' + mousePos.x + ',' + mousePos.y);

        if (!Canvas.mouse.isDragging) {
            console.log('dragging stopped');

            Canvas.mouse.isDragging = false;
        }
    },

    addSection: function(info) {
        this.items.push(info);

        this.draw();
    },

    clearDraw: function() {
        console.log('Clearing canvas');

        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    },

    drawGrid: function() {
        Drawer.drawLine(this.getContext(), 50, 50, 200, 200);
    },

    draw: function() {
        this.clearDraw();

        this.drawGrid();

        for (var itemIndex = 0; itemIndex < this.items.length; itemIndex++) {
            console.log('Draw section ' + itemIndex + ': ', this.items[itemIndex]);

            var item = this.items[itemIndex];

            var caption = "Section " + itemIndex;

            Drawer.drawText(this.getContext(), caption, item.x, item.y);

            Drawer.drawRectangle(this.getContext(), item.x, item.y, item.w, item.h);
        }
    },

    mouseIsWithinSection: function(event, item) {
        var mouse = this.getPosition(event);

        if (mouse.x >= item.x && mouse.x <= (item.x + item.w) &&
            mouse.y >= item.y && mouse.y <= (item.y + item.h)) {
            return true;
        }

        return false;
    }
};

// Main flow

Canvas.setElementId('canvas');

Canvas.init();

Canvas.addSection({x: 50, y: 50, w: 300, h: 200});

Canvas.addSection({x: 50, y: 300, w: 300, h: 200});

</script>

